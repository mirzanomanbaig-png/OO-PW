<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Correction Manager – Associate Action Checklist</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chosen Palette: Calm Harmony (Beige, Soft Grey, Muted Green, Subtle Amber) -->
    <!-- Application Structure Plan: A task-oriented, multi-step wizard to guide associates through the correction process. The flow is 1) Sequential Validation, 2) Informed Decision, 3) Final Documentation. This structure was chosen to enforce the procedural hierarchy and provide just-in-time rule information, making the workflow more intuitive and less error-prone than a static document. -->
    <!-- Visualization & Content Choices: Report Info: Validation Hierarchy -> Goal: Organize/Enforce -> Presentation: Interactive stepper/cards -> Interaction: "Mark as Reviewed" buttons to unlock next step -> Justification: Ensures procedural compliance. | Report Info: Action Rules -> Goal: Inform/Compare -> Presentation: Buttons with a dynamic text panel -> Interaction: Clicking an action displays its specific rules -> Justification: Reduces cognitive load by providing context at the point of decision. | New Feature: Documentation Assistant powered by the Gemini API to refine and professionalize user notes. | No charts used as the source is a procedural guide, not a dataset. Library/Method: Vanilla JS for state and DOM manipulation. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        .step-card {
            transition: all 0.3s ease;
        }
        .step-card.disabled {
            opacity: 0.5;
            pointer-events: none;
        }
        .action-btn.selected {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
    </style>
</head>
<body class="bg-stone-50 text-stone-800">

    <div class="container mx-auto px-4 py-8 md:py-12 max-w-4xl">
        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-bold text-stone-900">Correction Manager</h1>
            <p class="mt-2 text-lg text-stone-600">Interactive Associate Action Checklist</p>
        </header>

        <main id="checklist-app" class="space-y-8">
            
            <section id="validation-section" class="bg-white p-6 rounded-xl shadow-sm border border-stone-200">
                <h2 class="text-2xl font-semibold mb-1 text-stone-800">Step 1: Validate Correction</h2>
                <p class="text-stone-600 mb-6">Validate the correction using the sources below in the specified order. You must review each source before proceeding to the next.</p>
                <div id="validation-steps" class="space-y-4">
                    
                    <div id="step-0" class="step-card p-4 border border-stone-200 rounded-lg">
                        <div class="flex flex-col md:flex-row items-start md:items-center justify-between">
                            <div>
                                <h3 class="font-bold text-lg text-emerald-800">1. Ingestion Provider Rules</h3>
                                <p class="text-stone-600 mt-1">Check here first. These are the primary source of truth for processing.</p>
                            </div>
                            <button onclick="markStepReviewed(0)" class="mt-3 md:mt-0 md:ml-4 w-full md:w-auto bg-emerald-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-emerald-700 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500">
                                Mark as Reviewed
                            </button>
                        </div>
                    </div>
                    
                    <div id="step-1" class="step-card disabled p-4 border border-stone-200 rounded-lg">
                        <div class="flex flex-col md:flex-row items-start md:items-center justify-between">
                            <div>
                                <h3 class="font-bold text-lg text-emerald-800">2. Provider Knowledge Base (KB)</h3>
                                <p class="text-stone-600 mt-1">If not found in Provider Rules, check the Provider KB for specific instructions.</p>
                            </div>
                            <button onclick="markStepReviewed(1)" class="mt-3 md:mt-0 md:ml-4 w-full md:w-auto bg-emerald-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-emerald-700 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500">
                                Mark as Reviewed
                            </button>
                        </div>
                    </div>

                    <div id="step-2" class="step-card disabled p-4 border border-stone-200 rounded-lg">
                        <div class="flex flex-col md:flex-row items-start md:items-center justify-between">
                           <div>
                                <h3 class="font-bold text-lg text-emerald-800">3. General Rules from Knowledge Base (KB)</h3>
                                <p class="text-stone-600 mt-1">Use this for broader rules that apply across multiple providers.</p>
                           </div>
                           <button onclick="markStepReviewed(2)" class="mt-3 md:mt-0 md:ml-4 w-full md:w-auto bg-emerald-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-emerald-700 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500">
                               Mark as Reviewed
                            </button>
                        </div>
                    </div>

                    <div id="step-3" class="step-card disabled p-4 border border-stone-200 rounded-lg">
                        <div class="flex flex-col md:flex-row items-start md:items-center justify-between">
                           <div>
                                <h3 class="font-bold text-lg text-emerald-800">4. Account-Level Notes</h3>
                                <p class="text-stone-600 mt-1">These are specific instructions or exceptions for a single account.</p>
                           </div>
                           <button onclick="markStepReviewed(3)" class="mt-3 md:mt-0 md:ml-4 w-full md:w-auto bg-emerald-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-emerald-700 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500">
                               Mark as Reviewed
                           </button>
                        </div>
                    </div>

                </div>
            </section>

            <section id="action-section" class="bg-white p-6 rounded-xl shadow-sm border border-stone-200" style="display: none;">
                <h2 class="text-2xl font-semibold mb-1 text-stone-800">Step 2: Choose Action</h2>
                <p class="text-stone-600 mb-6">Based on your validation, select the appropriate action below. The criteria for each action will appear as you select it.</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <button id="btn-accept" onclick="selectAction('accept')" class="action-btn w-full p-4 text-lg font-semibold rounded-lg transition-all border-2 border-green-300 bg-green-50 text-green-800 hover:bg-green-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">Accept</button>
                    <button id="btn-accept-dispute" onclick="selectAction('accept-dispute')" class="action-btn w-full p-4 text-lg font-semibold rounded-lg transition-all border-2 border-amber-300 bg-amber-50 text-amber-800 hover:bg-amber-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500">Accept-Dispute</button>
                    <button id="btn-reject-dispute" onclick="selectAction('reject-dispute')" class="action-btn w-full p-4 text-lg font-semibold rounded-lg transition-all border-2 border-red-300 bg-red-50 text-red-800 hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">Reject-Dispute</button>
                </div>
                <div id="action-details" class="p-4 bg-stone-100 rounded-lg border border-stone-200 min-h-[120px]">
                    <p class="text-stone-500 italic">Select an action above to see the specific criteria.</p>
                </div>
            </section>
            
            <section id="documentation-section" class="bg-white p-6 rounded-xl shadow-sm border border-stone-200" style="display: none;">
                <h2 class="text-2xl font-semibold mb-1 text-stone-800">Step 3: Document & Finalize</h2>
                 <p class="text-stone-600 mb-6">Add any final notes required for audit purposes and finalize the process.</p>
                <div class="space-y-4">
                    <div>
                        <label for="final-notes" class="block text-md font-medium text-stone-700">Documentation Notes</label>
                        <textarea id="final-notes" rows="4" class="mt-1 block w-full rounded-md border-stone-300 shadow-sm focus:border-emerald-500 focus:ring-emerald-500 sm:text-sm" placeholder="Document any exceptions, reasons for dispute, or other relevant information here."></textarea>
                    </div>
                    <button onclick="draftNotesWithGemini()" id="draft-btn" class="w-full bg-blue-600 text-white px-6 py-3 rounded-lg font-bold text-lg hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        ✨ Draft Documentation Notes
                    </button>
                     <div id="summary" class="p-4 bg-blue-50 border border-blue-200 text-blue-800 rounded-lg">
                        <h3 class="font-bold">Summary</h3>
                        <p>Selected Action: <span id="summary-action" class="font-semibold">N/A</span></p>
                    </div>
                    <button onclick="resetChecklist()" class="w-full bg-stone-700 text-white px-6 py-3 rounded-lg font-bold text-lg hover:bg-stone-800 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-stone-500">
                        Complete & Start New Checklist
                    </button>
                </div>
            </section>

        </main>
    </div>

    <script>
        let appState = {
            currentStep: 0,
            selectedAction: null,
            finalNotes: ''
        };
        const apiKey = "";
        const apiUrl = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=" + apiKey;
        
        const actionContent = {
            'accept': {
                title: 'Use "Accept" if:',
                colorClasses: 'bg-green-50 border-green-200 text-green-800',
                details: `
                    <ul class="list-disc list-inside space-y-1">
                        <li>The correction is valid and aligns with instructions in any of the validation sources (even if you missed it initially).</li>
                        <li>The auditor's correction is accurate as per documented rules or notes.</li>
                    </ul>`
            },
            'accept-dispute': {
                title: 'Use "Accept-Dispute" if:',
                colorClasses: 'bg-amber-50 border-amber-200 text-amber-800',
                details: `
                    <ul class="list-disc list-inside space-y-1">
                        <li>The correction does not follow processing rules.</li>
                        <li>The change was made due to exceptional or one-time circumstances.</li>
                        <li>You validated the need for the change, but it is not due to an associate error.</li>
                    </ul>
                    <p class="mt-2 text-sm"><strong>Remember:</strong> Documentation of the exception must be retained or shared with leadership as needed.</p>`
            },
            'reject-dispute': {
                title: 'Use "Reject-Dispute" only if:',
                colorClasses: 'bg-red-50 border-red-200 text-red-800',
                details: `
                    <ul class="list-disc list-inside space-y-1">
                        <li>The correction is incorrect after proper review of all reference materials.</li>
                        <li>You are <strong>100% confident</strong> that the correction is invalid.</li>
                    </ul>
                    <p class="mt-2 text-sm font-bold"><strong>Important:</strong> If you are unsure or not fully confident, you must escalate to leadership for a secondary review before using this button.</p>`
            }
        };

        function markStepReviewed(stepIndex) {
            if (stepIndex !== appState.currentStep) return;

            const stepCard = document.getElementById(`step-${stepIndex}`);
            const button = stepCard.querySelector('button');

            stepCard.classList.add('bg-emerald-50');
            button.textContent = 'Reviewed';
            button.disabled = true;
            button.classList.remove('bg-emerald-600', 'hover:bg-emerald-700');
            button.classList.add('bg-emerald-200', 'text-emerald-700');
            
            appState.currentStep++;

            if (appState.currentStep < 4) {
                const nextStepCard = document.getElementById(`step-${appState.currentStep}`);
                nextStepCard.classList.remove('disabled');
            } else {
                document.getElementById('action-section').style.display = 'block';
                 setTimeout(() => {
                    document.getElementById('action-section').scrollIntoView({ behavior: 'smooth' });
                }, 100);
            }
        }

        function selectAction(action) {
            appState.selectedAction = action;
            
            document.querySelectorAll('.action-btn').forEach(btn => btn.classList.remove('selected', 'bg-green-100', 'bg-amber-100', 'bg-red-100'));
            
            const selectedBtn = document.getElementById(`btn-${action}`);
            selectedBtn.classList.add('selected');

            const content = actionContent[action];
            const detailsContainer = document.getElementById('action-details');
            
            detailsContainer.className = `p-4 rounded-lg border min-h-[120px] transition-all ${content.colorClasses}`;
            detailsContainer.innerHTML = `<h4 class="font-bold mb-2">${content.title}</h4>${content.details}`;
            
            document.getElementById('documentation-section').style.display = 'block';
            document.getElementById('summary-action').textContent = selectedBtn.textContent;
             setTimeout(() => {
                if(window.scrollY < document.getElementById('action-section').offsetTop) {
                   document.getElementById('documentation-section').scrollIntoView({ behavior: 'smooth' });
                }
            }, 100);
        }

        async function draftNotesWithGemini() {
            const userNotes = document.getElementById('final-notes').value;
            const draftBtn = document.getElementById('draft-btn');
            
            if (userNotes.trim() === '') {
                 document.getElementById('final-notes').value = "Please enter some notes to draft. For example, 'The correction was rejected because the data was incorrect as per the knowledge base.'";
                 return;
            }

            draftBtn.disabled = true;
            draftBtn.innerHTML = 'Drafting...';

            const systemPrompt = `You are a professional Correction Analyst Assistant. Your task is to take informal notes from an associate and refine them into a concise, professional, and audit-friendly documentation note. The note should be clear and to the point. Do not add any conversational text or intros like "Here is the refined note:". Just provide the refined text.`;
            const userQuery = `Refine the following documentation notes for a correction record: "${userNotes}"`;
            
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            const result = await response.json();
            const refinedText = result?.candidates?.[0]?.content?.parts?.[0]?.text;
            
            if (refinedText) {
                document.getElementById('final-notes').value = refinedText;
            } else {
                 document.getElementById('final-notes').value = userNotes + "\n\nError: Could not draft notes with the assistant. Please try again.";
            }

            draftBtn.disabled = false;
            draftBtn.innerHTML = '✨ Draft Documentation Notes';
        }

        function resetChecklist() {
            appState = { currentStep: 0, selectedAction: null, finalNotes: '' };

            for (let i = 0; i < 4; i++) {
                const stepCard = document.getElementById(`step-${i}`);
                const button = stepCard.querySelector('button');
                stepCard.classList.remove('bg-emerald-50');
                button.textContent = 'Mark as Reviewed';
                button.disabled = false;
                button.classList.remove('bg-emerald-200', 'text-emerald-700');
                button.classList.add('bg-emerald-600', 'hover:bg-emerald-700');
                if (i > 0) {
                    stepCard.classList.add('disabled');
                } else {
                    stepCard.classList.remove('disabled');
                }
            }

            document.getElementById('action-section').style.display = 'none';
            document.getElementById('documentation-section').style.display = 'none';

            const actionDetails = document.getElementById('action-details');
            actionDetails.className = 'p-4 bg-stone-100 rounded-lg border border-stone-200 min-h-[120px]';
            actionDetails.innerHTML = `<p class="text-stone-500 italic">Select an action above to see the specific criteria.</p>`;

            document.querySelectorAll('.action-btn').forEach(btn => btn.classList.remove('selected'));
            
            document.getElementById('final-notes').value = '';
            document.getElementById('summary-action').textContent = 'N/A';
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>
